<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Locker Selection</title>
    <style>
        /* Style for disabled lockers (gray out effect) */
        .disabled {
            pointer-events: none; /* Prevent clicking */
            opacity: 0.4; /* Make it visually grayed out */
        }
    </style>
    <script>
        async function fetchLockerAvailability() {
            try {
                let response = await fetch("https://cboulay07.github.io/locker-selection/lockers.json");
                let lockers = await response.json();

                document.querySelectorAll("area").forEach(area => {
                    let lockerID = area.getAttribute("alt");

                    if (lockers[lockerID] === "unavailable") {
                        area.classList.add("disabled"); // Apply gray-out style
                        area.removeAttribute("onclick"); // Disable click function
                        area.removeAttribute("href"); // Prevent any accidental navigation
                    }
                });
            } catch (error) {
                console.error("Error fetching locker data:", error);
            }
        }

        function selectLocker(lockerID) {
            let jotformURL = "https://form.jotform.com/250346205562047?selected_locker=" + lockerID;

            // If inside an iframe, break out and redirect full page
            if (window.top !== window.self) {
                window.top.location.replace(jotformURL);
            } else {
                window.location.replace(jotformURL);
            }
        }

        // Ensure locker availability is checked when the page loads
        window.onload = fetchLockerAvailability;
    </script>
</head>
<body>
    <h2>Select an Available Locker</h2>
    <img id="lockerMap" src="Casier.png" usemap="#image-map">

    <map name="image-map">
        <area shape="rect" coords="231,309,285,325" alt="R-15" title="R-15" href="#" onclick="selectLocker('R-15'); return false;">
        <area shape="rect" coords="290,310,345,325" alt="R-14" title="R-14" href="#" onclick="selectLocker('R-14'); return false;">
        <area shape="rect" coords="350,310,405,325" alt="R-13" title="R-13" href="#" onclick="selectLocker('R-13'); return false;">
    </map>
</body>
</html>

